<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>xSmileyy | DPS Analyzer & Compare</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --orange: #ff6600; --orange-glow: rgba(255, 102, 0, 0.4); --bg: #030303; --card-bg: rgba(15, 15, 15, 0.9); --glass: rgba(255, 255, 255, 0.03); --border: #222; --text-main: #ffffff; --text-dim: #888; --pos: #00ff88; --neg: #ff4444; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); background-image: radial-gradient(circle at 50% 0%, #1a0d00 0%, #030303 70%); color: var(--text-main); margin: 0; padding: 20px; min-height: 100vh; }
        .container { max-width: 1750px; margin: auto; }
        
        /* Tabs */
        .tab-bar { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .tab-btn { background: none; border: none; color: var(--text-dim); font-size: 16px; font-weight: 800; cursor: pointer; padding: 10px 25px; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .tab-btn.active { color: var(--orange); border-bottom: 2px solid var(--orange); }

        .nav-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { font-size: 24px; font-weight: 800; text-transform: uppercase; color: #fff; }
        .logo span { color: var(--orange); }

        .main-grid { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 30px; }
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; padding: 30px; backdrop-filter: blur(20px); }
        .section-title { font-size: 11px; font-weight: 800; color: var(--orange); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .section-title::after { content: ''; height: 1px; flex-grow: 1; background: var(--border); }
        
        .input-block { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; background: var(--glass); padding: 15px; border-radius: 12px; margin-bottom: 20px; }
        .group { display: flex; flex-direction: column; }
        label { font-size: 9px; font-weight: 700; color: var(--text-dim); margin-bottom: 4px; text-transform: uppercase; }
        input, select { background: #000; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 6px; font-size: 14px; font-family: 'JetBrains Mono'; }
        
        .btn-capture { background: #fff; color: #000; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; width: 100%; margin-top: 10px; transition: 0.3s; }
        .btn-capture:hover { background: var(--orange); color: #fff; }

        /* Comparison Table */
        .comp-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .comp-table th { text-align: left; padding: 15px; color: var(--text-dim); font-size: 10px; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        .comp-table td { padding: 20px 15px; border-bottom: 1px solid #111; font-family: 'JetBrains Mono'; vertical-align: top; }
        .diff-tag { display: block; font-size: 11px; margin-top: 5px; font-weight: 700; }
        .diff-pos { color: var(--pos); }
        .diff-neg { color: var(--neg); }
        .best-val { color: var(--orange); text-shadow: 0 0 10px var(--orange-glow); }

        .hidden { display: none !important; }
        .toggle-btn { flex: 1; background: #111; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .toggle-btn.active { background: var(--orange); border-color: var(--orange); }
        
        .range-display { background: #000; padding: 15px; border-radius: 12px; border: 1px solid #222; margin-bottom: 20px; }
        .range-result-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #111; font-size: 16px; font-family: 'JetBrains Mono'; }
        .results-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .res-box { background: #0a0a0a; border: 1px solid var(--border); padding: 15px; border-radius: 12px; }
        .res-val { font-size: 18px; font-weight: 700; font-family: 'JetBrains Mono'; display: block; }
    </style>
</head>
<body>

<div class="container">
    <header class="nav-header">
        <div class="logo">xSmileyy <span>DPS Lab</span></div>
        <div class="tab-bar">
            <button class="tab-btn active" onclick="showTab('calc')">Calculator</button>
            <button class="tab-btn" onclick="showTab('compare')">Comparison Matrix</button>
        </div>
    </header>

    <div id="tab-calc" class="main-grid">
        <div class="card">
            <div class="section-title">Base & Weapon</div>
            <div class="input-block">
                <div class="group"><label>Menu Damage</label><input type="number" id="h-game"></div>
                <div class="group"><label>All Wpn %</label><input type="number" id="h-awd"></div>
                <div class="group"><label>Spec. Wpn %</label><input type="number" id="h-swd"></div>
                <div class="group"><label>Calculated Base</label><input type="text" id="h-res" readonly onclick="this.select()"></div>
            </div>
            <div class="input-block">
                <div class="group"><label>Base Damage</label><input type="number" id="base"></div>
                <div class="group"><label>RPM</label><input type="number" id="rpm"></div>
                <div class="group"><label>Mag Size</label><input type="number" id="mag"></div>
                <div class="group"><label>Reload (s)</label><input type="number" id="rel"></div>
            </div>

            <div class="section-title">Bonuses & Multipliers</div>
            <div class="input-block">
                <div class="group"><label>AWD %</label><input type="number" id="awd"></div>
                <div class="group"><label>SWD %</label><input type="number" id="swd"></div>
                <div class="group"><label>Total Talent %</label><input type="number" id="twd"></div>
                <div class="group"><label>CHC %</label><input type="number" id="chc"></div>
                <div class="group"><label>CHD %</label><input type="number" id="chd"></div>
                <div class="group"><label>HSD %</label><input type="number" id="hsd"></div>
                <div class="group"><label>DttOOC %</label><input type="number" id="dttooc"></div>
                <div class="group"><label>DtA %</label><input type="number" id="dta"></div>
                <div class="group"><label>DtH %</label><input type="number" id="dth"></div>
            </div>

            <div class="section-title">Amplifiers (Multiplier)</div>
            <div class="input-block">
                <div class="group"><label>Mult 1 %</label><input type="number" id="m1"></div>
                <div class="group"><label>Mult 2 %</label><input type="number" id="m2"></div>
                <div class="group"><label>Mult 3 %</label><input type="number" id="m3"></div>
                <div class="group"><label>Mult 4 %</label><input type="number" id="m4"></div>
            </div>

            <div class="section-title">Capture Data</div>
            <div class="group">
                <input type="text" id="build-name" placeholder="Build Name (e.g. Strikers / High-End)" style="margin-bottom:10px;">
                <button class="btn-capture" onclick="captureBuild()">Add to Comparison Matrix</button>
            </div>
        </div>

        <div class="card" style="border-left: 4px solid var(--orange);">
            <div class="section-title">Range Validator</div>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button class="toggle-btn active" id="btn-dta" onclick="toggleMode('dta')">Vs Armor (Inv. Elite)</button>
                <button class="toggle-btn" id="btn-dth" onclick="toggleMode('dth')">Vs Health (Inv.)</button>
            </div>
            <div class="range-display">
                <div class="range-result-row"><span>White Hit</span><b id="val-body">-</b></div>
                <div class="range-result-row"><span>Headshot</span><b id="val-head" style="color: #ff4444;">-</b></div>
            </div>

            <div class="section-title">Current Performance</div>
            <div class="results-grid" style="margin-bottom: 20px;">
                <div class="res-box"><span class="res-label">Avg/Shot</span><span class="res-val" id="res-avg">-</span></div>
                <div class="res-box"><span class="res-label">Burst DPS</span><span class="res-val" id="res-burst">-</span></div>
            </div>

            <div class="section-title">Target EHP Analysis</div>
            <select id="enemy-select" style="width:100%; margin-bottom:15px;">
                <optgroup label="LEGENDARY">
                    <option value="25172134">Legendary [4P] - Elite</option>
                    <option value="72146660">Legendary [4P] - Named</option>
                </optgroup>
                <optgroup label="HEROIC">
                    <option value="16905653" selected>Heroic [4P] - Elite</option>
                    <option value="47296250">Heroic [4P] - Named</option>
                </optgroup>
            </select>
            <div class="results-grid">
                <div class="res-box"><span class="res-label">TTK (Burst)</span><span class="res-val" id="res-ttkb">-</span></div>
                <div class="res-box"><span class="res-label">Kills per Mag</span><span class="res-val" id="res-kpm">-</span></div>
            </div>
        </div>
    </div>

    <div id="tab-compare" class="card hidden">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="section-title">Comparison Matrix</div>
            <button class="toggle-btn" style="width:auto; padding:5px 15px;" onclick="clearCompare()">Clear All</button>
        </div>
        <table class="comp-table">
            <thead>
                <tr id="comp-header">
                    <th>Metric</th>
                    </tr>
            </thead>
            <tbody id="comp-body">
                </tbody>
        </table>
    </div>
</div>

<script>
    let vMode = 'dta';
    let capturedBuilds = [];

    function showTab(tab) {
        document.getElementById('tab-calc').classList.toggle('hidden', tab !== 'calc');
        document.getElementById('tab-compare').classList.toggle('hidden', tab !== 'compare');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(tab)));
        if(tab === 'compare') renderCompare();
    }

    function getVal(id) {
        const val = parseFloat(document.getElementById(id).value);
        return isNaN(val) ? 0 : val;
    }

    function toggleMode(m) { 
        vMode = m; 
        document.getElementById('btn-dta').classList.toggle('active', m === 'dta'); 
        document.getElementById('btn-dth').classList.toggle('active', m === 'dth'); 
        calculateAll(); 
    }

    function calculateAll() {
        const hRes = getVal('h-game') / (1 + (getVal('h-awd')+getVal('h-swd'))/100);
        document.getElementById('h-res').value = hRes > 0 ? hRes.toFixed(1) : "0";

        const base = getVal('base'), awd = getVal('awd'), swd = getVal('swd'), twd = getVal('twd');
        const chc = Math.min(60, getVal('chc'))/100, chd = getVal('chd')/100, hsd = getVal('hsd')/100;
        const dttooc = getVal('dttooc')/100, dta = getVal('dta')/100, dth = getVal('dth')/100;
        const mMult = (getVal('m1')/100+1)*(getVal('m2')/100+1)*(getVal('m3')/100+1)*(getVal('m4')/100+1);

        const armorMult = vMode === 'dta' ? (1+dta) : (1+dth);
        const vBody = base * (1+(awd+swd)/100) * (1+twd/100) * (1+dttooc) * armorMult * mMult;
        
        document.getElementById('val-body').innerText = Math.round(vBody).toLocaleString();
        document.getElementById('val-head').innerText = Math.round(vBody * (1+hsd)).toLocaleString();

        const avgShot = vBody * (1 + (chc*chd)) * (1 + (0.2 * hsd)); // Sim 20% HSD
        const rpm = getVal('rpm'), mag = getVal('mag'), rel = getVal('rel');
        const burstDps = (rpm/60) * avgShot;
        const sustainDps = (mag > 0) ? (mag * avgShot) / (rel + (mag/(rpm/60))) : 0;
        const targetEHP = parseFloat(document.getElementById('enemy-select').value);

        document.getElementById('res-avg').innerText = Math.round(avgShot).toLocaleString();
        document.getElementById('res-burst').innerText = Math.round(burstDps).toLocaleString();
        document.getElementById('res-ttkb').innerText = burstDps > 0 ? (targetEHP/burstDps).toFixed(2) + "s" : "-";
        document.getElementById('res-kpm').innerText = (targetEHP > 0) ? ( (avgShot*mag)/targetEHP ).toFixed(2) : "-";

        return { avgShot, burstDps, sustainDps, ttk: targetEHP/burstDps };
    }

    function captureBuild() {
        const stats = calculateAll();
        const name = document.getElementById('build-name').value || "Build " + (capturedBuilds.length + 1);
        capturedBuilds.push({ name, ...stats });
        alert(name + " captured!");
    }

    function clearCompare() { capturedBuilds = []; renderCompare(); }

    function renderCompare() {
        const header = document.getElementById('comp-header');
        const body = document.getElementById('comp-body');
        header.innerHTML = '<th>Metric</th>';
        body.innerHTML = '';

        if(capturedBuilds.length === 0) {
            body.innerHTML = '<tr><td colspan="5">No builds captured yet. Go to Calculator and click "Add to Comparison".</td></tr>';
            return;
        }

        capturedBuilds.forEach(b => { header.innerHTML += `<th>${b.name}</th>`; });

        const metrics = [
            { label: 'Avg Shot Damage', key: 'avgShot', higherBetter: true },
            { label: 'Burst DPS', key: 'burstDps', higherBetter: true },
            { label: 'Sustain DPS', key: 'sustainDps', higherBetter: true },
            { label: 'TTK (Burst)', key: 'ttk', higherBetter: false }
        ];

        metrics.forEach(m => {
            let row = `<tr><td><strong>${m.label}</strong></td>`;
            capturedBuilds.forEach((b, i) => {
                const val = b[m.key];
                let diffHtml = '';
                
                if(i > 0) {
                    const baseVal = capturedBuilds[0][m.key];
                    const diff = ((val - baseVal) / baseVal) * 100;
                    const isPos = m.higherBetter ? diff > 0 : diff < 0;
                    diffHtml = `<span class="diff-tag ${isPos ? 'diff-pos' : 'diff-neg'}">${diff > 0 ? '+' : ''}${diff.toFixed(1)}%</span>`;
                } else {
                    diffHtml = `<span class="diff-tag" style="color:var(--text-dim)">BASIS</span>`;
                }

                row += `<td>${Math.round(val).toLocaleString()}${diffHtml}</td>`;
            });
            row += '</tr>';
            body.innerHTML += row;
        });
    }

    document.querySelectorAll('input, select').forEach(i => i.addEventListener('input', calculateAll));
    window.onload = calculateAll;
</script>
</body>
</html>
